#include "arm_math.h"
#include "math_helper.h"
#include "stm32f3xx.h"

#define TEST_LENGTH_SAMPLES 1024
#define SNR_THRESHOLD_F32   130.0f
#define BLOCK_SIZE          1024
#define NUM_TAPS            1024

extern float32_t testInput_f32_1kHz_15kHz[TEST_LENGTH_SAMPLES];
extern float32_t refOutput[TEST_LENGTH_SAMPLES];

static float32_t testOutput[TEST_LENGTH_SAMPLES];

static float32_t firStateF32[NUM_TAPS + BLOCK_SIZE - 1];

const float32_t firCoeffsF32[NUM_TAPS] = {-1.90541932524624e-05, -4.60960000008414e-05, -4.62014984968074e-05, -1.91853151318225e-05, 1.92376971259446e-05, 4.65809433899714e-05, 4.67286112613755e-05, 1.94212205541310e-05, -1.94912719225836e-05, -4.72360294960769e-05, -4.74268449268663e-05, -1.97284124380370e-05, 1.98165397384757e-05, 4.80651810725863e-05, 4.83001289866243e-05, 2.01085212556831e-05, -2.02151339001682e-05, -4.90723482881043e-05, -4.93524206590089e-05, -2.05631890947119e-05, 2.06886994842643e-05, 5.02615100108913e-05, 5.05877062023135e-05, 2.10940702157179e-05, -2.12388938878273e-05, -5.16366752176648e-05, -5.20100023557268e-05, -2.17028316626057e-05, 2.18673874524564e-05, 5.32018845337727e-05, 5.36233579135119e-05, 2.23911539289294e-05, -2.25758641450847e-05, -5.49612119122688e-05, -5.54318554400358e-05, -2.31607316833778e-05, 2.33660222987991e-05, 5.69187664598618e-05, 5.74396131337346e-05, 2.40132745578262e-05, -2.42395754170835e-05, -5.90786944182161e-05, -5.96507868486520e-05, -2.49505080015970e-05, 2.51982530452099e-05, 6.14451813096536e-05, 6.20695722827073e-05, 2.59741742057386e-05, -2.62438017126861e-05, -6.40224542568435e-05, -6.47002073424647e-05, -2.70860331014996e-05, 2.73779859509162e-05, 6.68147844867490e-05, 6.75469746948278e-05, 2.82878634373320e-05, -2.86025893905845e-05, -6.98264900297536e-05, -7.06142045167449e-05, -2.95814639391180e-05, 2.99194159434457e-05, 7.30619386256402e-05, 7.39062774548209e-05, 3.09686545586364e-05, -3.13302910736534e-05, -7.65255508488788e-05, -7.74276278074870e-05, -3.24512778155474e-05, 3.28370631640361e-05, 8.02218034665801e-05, 8.11827469432957e-05, 3.40312002386875e-05, -3.44416049831371e-05, -8.41552330433452e-05, -8.51761869698576e-05, -3.57103139127288e-05, 3.61458152592111e-05, 8.83304398083132e-05, 8.94125646689388e-05, 3.74905381367767e-05, -3.79516203679112e-05, -9.27520918007743e-05, -9.38965657144147e-05, -3.93738212019210e-05, 3.98609761407237e-05, 9.74249293118998e-05, 9.86329491909326e-05, 4.13621422953098e-05, -4.18758698018910e-05, -0.000102353769641478, -0.000103626552432490, -4.34575135387613e-05, 4.39983220420436e-05, 0.000107543512189875, 0.000108882296201552, 4.56619821707206e-05, -4.62303892373710e-05, -0.000112999143907033, -0.000114405190230914, -4.79776328808434e-05, 4.85741658239549e-05, 0.000118725745121950, 0.000120200339152150, 5.04065903073097e-05, -5.10317868374133e-05, -0.000124728495777874, -0.000126272948836439, -5.29510217077627e-05, 5.36054306290113e-05, 0.000131012682100480, 0.000132628333175461, 5.56131398154828e-05, -5.62973217701466e-05, -0.000137583703728352, -0.000139271921332325, -5.83952058935746e-05, 5.91097341580574e-05, 0.000144447081337524, 0.000146209265494890, 6.12995330007239e-05, -6.20449943367936e-05, -0.000151608464794346, -0.000153446049166370, -6.43284894833206e-05, 6.51054850483590e-05, 0.000159073641873773, 0.000160988096031134, 6.74845027099781e-05, -6.82936490304407e-05, -0.000166848547583192, -0.000168841379436592, -7.07700630656268e-05, 7.16119930783420e-05, 0.000174939274135359, 0.000177012032535601, 7.41877282241212e-05, -7.50630923902892e-05, -0.000183352081617565, -0.000185506359137566, -7.77401277195974e-05, 7.86495952168388e-05, 0.000192093409408314, 0.000194330845320471, 8.14299678387511e-05, -8.23742278371210e-05, -0.000201169888397160, -0.000203492171860791, -8.52600368580598e-05, 8.62397998862754e-05, 0.000210588354068246, 0.000212997227543044, 8.92332106521886e-05, -9.02492100609578e-05, -0.000220355860513524, -0.000222853123416380, -9.33524587019071e-05, 9.44054522319949e-05, 0.000230479695447407, 0.000233067208071590, 9.76208505328215e-05, -9.87116219958776e-05, -0.000240967396301296, -0.000243647084018681, -0.000102041562618669, 0.000103170923699958, 0.000251826767483525, 0.000254600625252430, 0.000106617885786282, -0.000107786677978979, -0.000263065898898227, -0.000265935996101660, -0.000111353233162812, 0.000112562329844587, 0.000274693185825583, 0.000277661671466885, 0.000116251148709381, -0.000117501457373132, -0.000286717350275411, -0.000289786458561038, -0.000121315316390045, 0.000122607781041453, 0.000299147463937153, 0.000302319520279150, 0.000126549570029222, -0.000127885173765483, -0.000311992972861165, -0.000315270400335059, -0.000131957903916242, 0.000133337671701354, 0.000325263724019650, 0.000328649050317149, 0.000137544484221506, -0.000138969485875246, -0.000338969993910416, -0.000342465858830224, -0.000143313661295038, 0.000144785014714511, 0.000353122519383256, 0.000356731682907766, 0.000149269982925876, -0.000150788857560356, -0.000367732530887238, -0.000371457881897766, -0.000155418208648280, 0.000156985829250383, 0.000382811788357836, 0.000386656354046707, 0.000161763325190455, -0.000163380975868832, -0.000398372619986003, -0.000402339576029954, -0.000168310563170945, 0.000169979591772869, 0.000414427964137298, 0.000418520645703531, 0.000175065415159848, -0.000176787238014639, -0.000430991414718062, -0.000435213328382333, -0.000182033655234406, 0.000183809762292280, 0.000448077270318653, 0.000452432106983286, 0.000189221360172880, -0.000191053320577910, -0.000465700587500285, -0.000470192236410185, -0.000196634932447146, 0.000198524400586873, 0.000483877238633711, 0.000488509802599511, 0.000204281125192412, -0.000206229847272028, -0.000502623974744886, -0.000507401786694937, -0.000212167069353042, 0.000214176890547486, 0.000521958493875620, 0.000526886134873038, 0.000220300303227368, -0.000222373175470765, -0.000541899515527490, -0.000546981834404638, -0.000228688804660104, 0.000230826795139695, 0.000562466861825495, 0.000567708996606611, 0.000237341026161885, -0.000239546326591157, -0.000583681546115318, -0.000589088947419323, -0.000246265933269239, 0.000248540870024512, 0.000605565869796756, 0.000611144326435888, 0.000255473046497417, -0.000257820091713071, -0.000628143528296442, -0.000633899195314066, -0.000264972487283581, 0.000267394271012567, 0.000651439727198547, 0.000657379156620770, 0.000274775028368614, -0.000277274351929437, -0.000675481309684446, -0.000681611484296006, -0.000284892149124433, 0.000287471999771557, 0.000700296896583953, 0.000706625267080540, 0.000295336096401787, -0.000297999663474515, -0.000725917040515733, -0.000732451566432511, -0.000306119951550281, 0.000308870644277154, 0.000752374395796175, 0.000759123590667191, 0.000317257704353128, -0.000320099171512635, -0.000779703906028793, -0.000786676887296253, -0.000328764334722447, 0.000331700486389634, 0.000807943011556910, 0.000815149555822837, 0.000340655903121452, -0.000343690934763574, -0.000837131879275759, -0.000844582483575225, -0.000352949650820773, 0.000356088070042732, 0.000867313657666083, 0.000875019607541584, 0.000365664111259157, -0.000368910767545365, -0.000898534760338270, -0.000906508205612303, -0.000378819233970077, 0.000382179351821838, 0.000930845181875822, 0.000939099221157048, 0.000392436522760957, -0.000395915738690035, -0.000964298850354336, -0.000972847625474941, -0.000406539190094256, 0.000410143594007320, 0.000998954021603832, 0.00100781282337699, 0.000421152329932218, -0.000424888511526045, -0.00103487372109877, -0.00104405910801245, -0.000436303111674500, 0.000440178212564579, 0.00107212624032898, 0.00108165617206090, 0.000452020998254949, -0.000456042770682393, -0.00111078569565523, -0.00112067968361508, -0.000468337991985185, 0.000472514865090835, 0.00115093265902691, 0.00116121193651537, 0.000485288912354084, -0.000489630067183747, -0.00119265487158371, -0.00120334258661761, -0.000502911710738385, 0.000507427165351865, 0.00123604805313852, 0.00124716948754646, 0.000521247827879316, -0.000525948534187705, -0.00128121682292300, -0.00129279964198560, -0.000540342601064296, 0.000545240555327089, 0.00132827574986374, 0.00134035028758642, 0.000560245729272598, -0.000565354098556811, -0.00137735055416784, -0.00138995014026705, -0.000581011806149190, 0.000586345073507962, 0.00142857948628597, 0.00144174082218475, 0.000602700932637657, -0.000608275064324834, -0.00148211491458348, -0.00149587850720877, -0.000625379423523511, 0.000631212062247790, 0.00153812515953976, 0.00155253582356378, 0.000649120625127942, -0.000655231314205553, -0.00159679662033738, -0.00161190406180566, -0.000674005865108300, 0.000680416309436820, 0.00165833624972024, 0.00167419574688335, 0.000700125559962300, -0.000706859931072323, -0.00172297444554837, -0.00173964764632798, -0.000727580511662245, 0.000734665805785524, 0.00179096844328703, 0.00180852430337646, 0.000756483432213791, -0.000763949892439980, -0.00186260631370942, -0.00188112220512372, -0.000786960744302349, 0.000794842360620213, 0.00193821169566314, 0.00195777472300271, 0.000819154718184908, -0.000827489822705268, -0.00201814942659770, -0.00203885799790012, -0.000853226020446371, 0.000862057999638102, 0.00210283227605128, 0.00212479798759691, 0.000889356770321957, -0.000898734922008671, -0.00219272904270688, -0.00221607895350904, -0.000927754225573585, 0.000937734796221333, 0.00228837434846301, 0.00231325374179315, 0.000968655254607842, -0.000979302702761793, -0.00239038055952661, -0.00241695631764595, -0.00101233179773402, 0.00102372034329400, 0.00249945239374115, 0.00252791715079640, 0.00105909758259361, -0.00107131312032725, -0.00261640494794561, -0.00264698223872234, -0.00110931644317974, 0.00112245892444553, 0.00274218611755148, 0.00277513681226620, 0.00116341270773558, -0.00117759912974417, -0.00287790470973078, -0.00291353512586112, -0.00122188428178415, 0.00123725247320671, 0.00302486601176957, 0.00306353823592767, 0.00128531927898521, -0.00130203274088159, -0.00318461722781453, -0.00322676238344565, -0.00135441737542776, 0.00137267153738780, 0.00335900613328093, 0.00340514162384776, 0.00143001753029142, -0.00145004792910259, -0.00355025766149646, -0.00360100985165001, -0.00151313440304728, 0.00153522751020863, 0.00376107516220834, 0.00381720960828467, 0.00160500682586081, -0.00162951458167023, -0.00399477613070256, -0.00405723846348577, -0.00170716325886825, 0.00173452288257320, 0.00425547692147219, 0.00432544903219844, 0.00182151160073397, -0.00185227305439565, -0.00454834839150746, -0.00462732704643228, -0.00195046462635301, 0.00198532941841120, 0.00487997642242259, 0.00496988549141750, 0.00209711870762608, -0.00213699589987365, -0.00525888120411957, -0.00536223554999239, -0.00226551423494416, 0.00231160325645534, 0.00569628330618128, 0.00581643436795349, 0.00246102490679944, -0.00251494143239045, -0.00620726514035303, -0.00634877999172424, -0.00269095697308397, 0.00275493045256909, 0.00681258830705803, 0.00698185518496111, 0.00296550358523905, -0.00304269894818874, -0.00754164383251201, -0.00774787928703046, -0.00329932666398907, 0.00339439182617665, 0.00843745474387250, 0.00869446140207849, 0.00371430691519015, -0.00383435521017489, -0.00956561509602266, -0.00989503414772451, -0.00424460964807996, 0.00440110096595096, 0.0110313247196342, 0.0114691074013888, 0.00494671302724121, -0.00515936265650267, -0.0130145943658715, -0.0136251308783763, -0.00592117671651856, 0.00622698959513392, 0.0158511223885921, 0.0167621396725177, 0.00736607400426126, -0.00784348330250896, -0.0202470362778195, -0.0217521029779962, -0.00973301360805705, 0.0105815665686735, 0.0279844719812066, 0.0309355748421586, 0.0143236936325714, -0.0162357735119117, -0.0452323691771234, -0.0534620027433992, -0.0270680766331374, 0.0348042286091180, 0.117640901157540, 0.196074973395423, 0.243654967707109, 0.243654967707109, 0.196074973395423, 0.117640901157540, 0.0348042286091180, -0.0270680766331374, -0.0534620027433992, -0.0452323691771234, -0.0162357735119117, 0.0143236936325714, 0.0309355748421586, 0.0279844719812066, 0.0105815665686735, -0.00973301360805705, -0.0217521029779962, -0.0202470362778195, -0.00784348330250896, 0.00736607400426126, 0.0167621396725177, 0.0158511223885921, 0.00622698959513392, -0.00592117671651856, -0.0136251308783763, -0.0130145943658715, -0.00515936265650267, 0.00494671302724121, 0.0114691074013888, 0.0110313247196342, 0.00440110096595096, -0.00424460964807996, -0.00989503414772451, -0.00956561509602266, -0.00383435521017489, 0.00371430691519015, 0.00869446140207849, 0.00843745474387250, 0.00339439182617665, -0.00329932666398907, -0.00774787928703046, -0.00754164383251201, -0.00304269894818874, 0.00296550358523905, 0.00698185518496111, 0.00681258830705803, 0.00275493045256909, -0.00269095697308397, -0.00634877999172424, -0.00620726514035303, -0.00251494143239045, 0.00246102490679944, 0.00581643436795349, 0.00569628330618128, 0.00231160325645534, -0.00226551423494416, -0.00536223554999239, -0.00525888120411957, -0.00213699589987365, 0.00209711870762608, 0.00496988549141750, 0.00487997642242259, 0.00198532941841120, -0.00195046462635301, -0.00462732704643228, -0.00454834839150746, -0.00185227305439565, 0.00182151160073397, 0.00432544903219844, 0.00425547692147219, 0.00173452288257320, -0.00170716325886825, -0.00405723846348577, -0.00399477613070256, -0.00162951458167023, 0.00160500682586081, 0.00381720960828467, 0.00376107516220834, 0.00153522751020863, -0.00151313440304728, -0.00360100985165001, -0.00355025766149646, -0.00145004792910259, 0.00143001753029142, 0.00340514162384776, 0.00335900613328093, 0.00137267153738780, -0.00135441737542776, -0.00322676238344565, -0.00318461722781453, -0.00130203274088159, 0.00128531927898521, 0.00306353823592767, 0.00302486601176957, 0.00123725247320671, -0.00122188428178415, -0.00291353512586112, -0.00287790470973078, -0.00117759912974417, 0.00116341270773558, 0.00277513681226620, 0.00274218611755148, 0.00112245892444553, -0.00110931644317974, -0.00264698223872234, -0.00261640494794561, -0.00107131312032725, 0.00105909758259361, 0.00252791715079640, 0.00249945239374115, 0.00102372034329400, -0.00101233179773402, -0.00241695631764595, -0.00239038055952661, -0.000979302702761793, 0.000968655254607842, 0.00231325374179315, 0.00228837434846301, 0.000937734796221333, -0.000927754225573585, -0.00221607895350904, -0.00219272904270688, -0.000898734922008671, 0.000889356770321957, 0.00212479798759691, 0.00210283227605128, 0.000862057999638102, -0.000853226020446371, -0.00203885799790012, -0.00201814942659770, -0.000827489822705268, 0.000819154718184908, 0.00195777472300271, 0.00193821169566314, 0.000794842360620213, -0.000786960744302349, -0.00188112220512372, -0.00186260631370942, -0.000763949892439980, 0.000756483432213791, 0.00180852430337646, 0.00179096844328703, 0.000734665805785524, -0.000727580511662245, -0.00173964764632798, -0.00172297444554837, -0.000706859931072323, 0.000700125559962300, 0.00167419574688335, 0.00165833624972024, 0.000680416309436820, -0.000674005865108300, -0.00161190406180566, -0.00159679662033738, -0.000655231314205553, 0.000649120625127942, 0.00155253582356378, 0.00153812515953976, 0.000631212062247790, -0.000625379423523511, -0.00149587850720877, -0.00148211491458348, -0.000608275064324834, 0.000602700932637657, 0.00144174082218475, 0.00142857948628597, 0.000586345073507962, -0.000581011806149190, -0.00138995014026705, -0.00137735055416784, -0.000565354098556811, 0.000560245729272598, 0.00134035028758642, 0.00132827574986374, 0.000545240555327089, -0.000540342601064296, -0.00129279964198560, -0.00128121682292300, -0.000525948534187705, 0.000521247827879316, 0.00124716948754646, 0.00123604805313852, 0.000507427165351865, -0.000502911710738385, -0.00120334258661761, -0.00119265487158371, -0.000489630067183747, 0.000485288912354084, 0.00116121193651537, 0.00115093265902691, 0.000472514865090835, -0.000468337991985185, -0.00112067968361508, -0.00111078569565523, -0.000456042770682393, 0.000452020998254949, 0.00108165617206090, 0.00107212624032898, 0.000440178212564579, -0.000436303111674500, -0.00104405910801245, -0.00103487372109877, -0.000424888511526045, 0.000421152329932218, 0.00100781282337699, 0.000998954021603832, 0.000410143594007320, -0.000406539190094256, -0.000972847625474941, -0.000964298850354336, -0.000395915738690035, 0.000392436522760957, 0.000939099221157048, 0.000930845181875822, 0.000382179351821838, -0.000378819233970077, -0.000906508205612303, -0.000898534760338270, -0.000368910767545365, 0.000365664111259157, 0.000875019607541584, 0.000867313657666083, 0.000356088070042732, -0.000352949650820773, -0.000844582483575225, -0.000837131879275759, -0.000343690934763574, 0.000340655903121452, 0.000815149555822837, 0.000807943011556910, 0.000331700486389634, -0.000328764334722447, -0.000786676887296253, -0.000779703906028793, -0.000320099171512635, 0.000317257704353128, 0.000759123590667191, 0.000752374395796175, 0.000308870644277154, -0.000306119951550281, -0.000732451566432511, -0.000725917040515733, -0.000297999663474515, 0.000295336096401787, 0.000706625267080540, 0.000700296896583953, 0.000287471999771557, -0.000284892149124433, -0.000681611484296006, -0.000675481309684446, -0.000277274351929437, 0.000274775028368614, 0.000657379156620770, 0.000651439727198547, 0.000267394271012567, -0.000264972487283581, -0.000633899195314066, -0.000628143528296442, -0.000257820091713071, 0.000255473046497417, 0.000611144326435888, 0.000605565869796756, 0.000248540870024512, -0.000246265933269239, -0.000589088947419323, -0.000583681546115318, -0.000239546326591157, 0.000237341026161885, 0.000567708996606611, 0.000562466861825495, 0.000230826795139695, -0.000228688804660104, -0.000546981834404638, -0.000541899515527490, -0.000222373175470765, 0.000220300303227368, 0.000526886134873038, 0.000521958493875620, 0.000214176890547486, -0.000212167069353042, -0.000507401786694937, -0.000502623974744886, -0.000206229847272028, 0.000204281125192412, 0.000488509802599511, 0.000483877238633711, 0.000198524400586873, -0.000196634932447146, -0.000470192236410185, -0.000465700587500285, -0.000191053320577910, 0.000189221360172880, 0.000452432106983286, 0.000448077270318653, 0.000183809762292280, -0.000182033655234406, -0.000435213328382333, -0.000430991414718062, -0.000176787238014639, 0.000175065415159848, 0.000418520645703531, 0.000414427964137298, 0.000169979591772869, -0.000168310563170945, -0.000402339576029954, -0.000398372619986003, -0.000163380975868832, 0.000161763325190455, 0.000386656354046707, 0.000382811788357836, 0.000156985829250383, -0.000155418208648280, -0.000371457881897766, -0.000367732530887238, -0.000150788857560356, 0.000149269982925876, 0.000356731682907766, 0.000353122519383256, 0.000144785014714511, -0.000143313661295038, -0.000342465858830224, -0.000338969993910416, -0.000138969485875246, 0.000137544484221506, 0.000328649050317149, 0.000325263724019650, 0.000133337671701354, -0.000131957903916242, -0.000315270400335059, -0.000311992972861165, -0.000127885173765483, 0.000126549570029222, 0.000302319520279150, 0.000299147463937153, 0.000122607781041453, -0.000121315316390045, -0.000289786458561038, -0.000286717350275411, -0.000117501457373132, 0.000116251148709381, 0.000277661671466885, 0.000274693185825583, 0.000112562329844587, -0.000111353233162812, -0.000265935996101660, -0.000263065898898227, -0.000107786677978979, 0.000106617885786282, 0.000254600625252430, 0.000251826767483525, 0.000103170923699958, -0.000102041562618669, -0.000243647084018681, -0.000240967396301296, -9.87116219958776e-05, 9.76208505328215e-05, 0.000233067208071590, 0.000230479695447407, 9.44054522319949e-05, -9.33524587019071e-05, -0.000222853123416380, -0.000220355860513524, -9.02492100609578e-05, 8.92332106521886e-05, 0.000212997227543044, 0.000210588354068246, 8.62397998862754e-05, -8.52600368580598e-05, -0.000203492171860791, -0.000201169888397160, -8.23742278371210e-05, 8.14299678387511e-05, 0.000194330845320471, 0.000192093409408314, 7.86495952168388e-05, -7.77401277195974e-05, -0.000185506359137566, -0.000183352081617565, -7.50630923902892e-05, 7.41877282241212e-05, 0.000177012032535601, 0.000174939274135359, 7.16119930783420e-05, -7.07700630656268e-05, -0.000168841379436592, -0.000166848547583192, -6.82936490304407e-05, 6.74845027099781e-05, 0.000160988096031134, 0.000159073641873773, 6.51054850483590e-05, -6.43284894833206e-05, -0.000153446049166370, -0.000151608464794346, -6.20449943367936e-05, 6.12995330007239e-05, 0.000146209265494890, 0.000144447081337524, 5.91097341580574e-05, -5.83952058935746e-05, -0.000139271921332325, -0.000137583703728352, -5.62973217701466e-05, 5.56131398154828e-05, 0.000132628333175461, 0.000131012682100480, 5.36054306290113e-05, -5.29510217077627e-05, -0.000126272948836439, -0.000124728495777874, -5.10317868374133e-05, 5.04065903073097e-05, 0.000120200339152150, 0.000118725745121950, 4.85741658239549e-05, -4.79776328808434e-05, -0.000114405190230914, -0.000112999143907033, -4.62303892373710e-05, 4.56619821707206e-05, 0.000108882296201552, 0.000107543512189875, 4.39983220420436e-05, -4.34575135387613e-05, -0.000103626552432490, -0.000102353769641478, -4.18758698018910e-05, 4.13621422953098e-05, 9.86329491909326e-05, 9.74249293118998e-05, 3.98609761407237e-05, -3.93738212019210e-05, -9.38965657144147e-05, -9.27520918007743e-05, -3.79516203679112e-05, 3.74905381367767e-05, 8.94125646689388e-05, 8.83304398083132e-05, 3.61458152592111e-05, -3.57103139127288e-05, -8.51761869698576e-05, -8.41552330433452e-05, -3.44416049831371e-05, 3.40312002386875e-05, 8.11827469432957e-05, 8.02218034665801e-05, 3.28370631640361e-05, -3.24512778155474e-05, -7.74276278074870e-05, -7.65255508488788e-05, -3.13302910736534e-05, 3.09686545586364e-05, 7.39062774548209e-05, 7.30619386256402e-05, 2.99194159434457e-05, -2.95814639391180e-05, -7.06142045167449e-05, -6.98264900297536e-05, -2.86025893905845e-05, 2.82878634373320e-05, 6.75469746948278e-05, 6.68147844867490e-05, 2.73779859509162e-05, -2.70860331014996e-05, -6.47002073424647e-05, -6.40224542568435e-05, -2.62438017126861e-05, 2.59741742057386e-05, 6.20695722827073e-05, 6.14451813096536e-05, 2.51982530452099e-05, -2.49505080015970e-05, -5.96507868486520e-05, -5.90786944182161e-05, -2.42395754170835e-05, 2.40132745578262e-05, 5.74396131337346e-05, 5.69187664598618e-05, 2.33660222987991e-05, -2.31607316833778e-05, -5.54318554400358e-05, -5.49612119122688e-05, -2.25758641450847e-05, 2.23911539289294e-05, 5.36233579135119e-05, 5.32018845337727e-05, 2.18673874524564e-05, -2.17028316626057e-05, -5.20100023557268e-05, -5.16366752176648e-05, -2.12388938878273e-05, 2.10940702157179e-05, 5.05877062023135e-05, 5.02615100108913e-05, 2.06886994842643e-05, -2.05631890947119e-05, -4.93524206590089e-05, -4.90723482881043e-05, -2.02151339001682e-05, 2.01085212556831e-05, 4.83001289866243e-05, 4.80651810725863e-05, 1.98165397384757e-05, -1.97284124380370e-05, -4.74268449268663e-05, -4.72360294960769e-05, -1.94912719225836e-05, 1.94212205541310e-05, 4.67286112613755e-05, 4.65809433899714e-05, 1.92376971259446e-05, -1.91853151318225e-05, -4.62014984968074e-05, -4.60960000008414e-05, -1.90541932524624e-05};

uint32_t blockSize = BLOCK_SIZE;
uint32_t numBlocks = TEST_LENGTH_SAMPLES / BLOCK_SIZE;
float32_t snr;

int main() {
    uint32_t i;
    arm_fir_instance_f32 S;
    arm_status status;
    float32_t *inputF32, *outputF32;
    
    inputF32 = &testInput_f32_1kHz_15kHz[0];
    outputF32 = &testOutput[0];
    
    arm_fir_init_f32(&S, NUM_TAPS, (float32_t *)&firCoeffsF32[0], &firStateF32[0], blockSize);
    
    RCC->AHBENR |= RCC_AHBENR_GPIOEEN;
    GPIOE->MODER |= (1 << 9*2) | (1 << 8*2);
    GPIOE->BSRRH |= 1 << 8;
    while (1) {
        GPIOE->BSRRL |= 1 << 9;
        for (i = 0; i < numBlocks; i++) {
            arm_fir_f32(&S, inputF32 + i * blockSize, outputF32 + i * blockSize, blockSize);
        }
        GPIOE->BSRRH |= 1 << 9;
        
        snr = arm_snr_f32(&refOutput[0], &testOutput[0], TEST_LENGTH_SAMPLES);
        if (snr < SNR_THRESHOLD_F32) {
            status = ARM_MATH_TEST_FAILURE;
            GPIOE->BSRRL |= 1 << 8;
        } else {
            status = ARM_MATH_SUCCESS;
        }
    }
}
